<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using CemConnector • CemConnector</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using CemConnector">
<meta property="og:description" content="CemConnector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CemConnector</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CommonEvidenceExplorerPlugin.html">Common Evidence Explorer Plugin</a>
    </li>
    <li>
      <a href="../articles/UsingCemConnector.html">Using CemConnector</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="UsingCemConnector_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using CemConnector</h1>
            
            <h4 class="date">2021-11-04</h4>
      
      
      <div class="hidden name"><code>UsingCemConnector.Rmd</code></div>

    </div>

    
    
<style type="text/css">
h1  {
  margin-top: 60px;
}
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>If you’re reading this guide it is expected that you have some familiarity with the common evidence model (CEM) and have an installation set up and configured. Please refer to (the CEM github repository)[<a href="https://github.com/OHDSI/CommonEvidenceModel" class="uri">https://github.com/OHDSI/CommonEvidenceModel</a>] for more information.</p>
<p>The following guide highlights how to use the CemConnector package (following installation instructions provided in the readme).</p>
</div>
<div id="connecting" class="section level1">
<h1 class="hasAnchor">
<a href="#connecting" class="anchor"></a>Connecting</h1>
<p>CemConnector provides two methods to connect to a Cem that are functionally equivalent: connecting via a web api and connecting via a database.</p>
<div id="using-cemconnector-with-a-web-backend" class="section level2">
<h2 class="hasAnchor">
<a href="#using-cemconnector-with-a-web-backend" class="anchor"></a>Using CEMConnector with a web backend</h2>
<p>The simplest way to connect with the CEM is to connect to a host web instance, for example the public API available at <a href="https://cem.ohdsi.org/" class="uri">https://cem.ohdsi.org/</a> (NOTE: TBD). To do this we will use a web backend. First we need to create a connection to the web api:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">cemConnection</span> <span class="op">&lt;-</span> <span class="fu">CemConnector</span><span class="fu">::</span><span class="fu"><a href="../reference/CemWebApiBackend.html">CemWebApiBackend</a></span><span class="op">(</span>apiUrl <span class="op">=</span> <span class="st">"https://cem.ohdsi.org/"</span><span class="op">)</span></code></pre></div>
</div>
<div id="using-cemconnector-with-a-database-backend" class="section level2">
<h2 class="hasAnchor">
<a href="#using-cemconnector-with-a-database-backend" class="anchor"></a>Using CEMConnector with a database backend</h2>
<p>Alternatively, a connection can be made with a DatabaseConnector::connectionDetails object. Contact your CEM administrator for details connecting this way.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html">createConnectionDetails</a></span><span class="op">(</span>user <span class="op">=</span> <span class="st">"mydbusername"</span>,
                                                                server <span class="op">=</span> <span class="st">"myserver/foo"</span>,
                                                                dbms <span class="op">=</span> <span class="st">"redshift"</span>,
                                                                password <span class="op">=</span> <span class="st">"mysecret"</span><span class="op">)</span>

<span class="va">cemConnection</span> <span class="op">&lt;-</span> <span class="fu">CemConnector</span><span class="fu">::</span><span class="va"><a href="../reference/CemDatabaseBackend.html">CemDatabaseBackend</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                                                      vocabularySchema <span class="op">=</span> <span class="st">"vocabulary"</span>,
                                                      cemSchema <span class="op">=</span> <span class="st">"cem_v2"</span>,
                                                      sourceSchema <span class="op">=</span> <span class="st">"cem_v2_source"</span><span class="op">)</span></code></pre></div>
<p>This should connect to the server without error.</p>
</div>
<div id="viewing-evidence-sources" class="section level2">
<h2 class="hasAnchor">
<a href="#viewing-evidence-sources" class="anchor"></a>Viewing evidence sources</h2>
<p>The available evidence sources in the Cem are visible as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cemConnection</span><span class="op">$</span><span class="fu">getCemSourceInfo</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 × 9</span>
<span class="co">#&gt;    sourceId  description   provenance contributorOrgan… contactName creationDate</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;      &lt;chr&gt;             &lt;chr&gt;       &lt;date&gt;      </span>
<span class="co">#&gt;  1 AEOLUS    "Spontaneous… AEOLUS     Center for Biome… Lee Evans … 2021-01-02  </span>
<span class="co">#&gt;  2 COMMONEV… "CommonEvide… COMMONEVI… OHDSI             Erica Voss  2020-02-26  </span>
<span class="co">#&gt;  3 EU_PL_ADR "From the PR… EU_PL_ADR  PROTECT           PROTECT     2020-12-20  </span>
<span class="co">#&gt;  4 MEDLINE_… "Co-occurren… MEDLINE    Janssen R&amp;D       Erica Voss  2020-02-09  </span>
<span class="co">#&gt;  5 MEDLINE_… "Co-occurren… PUBMED     Janssen R&amp;D       Erica Voss  2020-02-19  </span>
<span class="co">#&gt;  6 MEDLINE_… "Winnenburg … MEDLINE    Janssen R&amp;D       Erica Voss  2020-02-19  </span>
<span class="co">#&gt;  7 OMOP_VOC… "OMOP Vocabu… VOCABULARY OHDSI             Odysseus    2020-08-12  </span>
<span class="co">#&gt;  8 SEMMEDDB  "Semantic Me… SEMMEDDB   National Institu… National I… 2020-12-20  </span>
<span class="co">#&gt;  9 SHERLOCK  "ClinicalTri… SHERLOCK   Janssen R&amp;D       Erica Voss  2020-01-27  </span>
<span class="co">#&gt; 10 SPLICER   "Adverse dru… SPLICER    Georgia Tech      Jon Duke    2019-12-08  </span>
<span class="co">#&gt; # … with 3 more variables: coverageStartDate &lt;date&gt;, coverageEndDate &lt;date&gt;,</span>
<span class="co">#&gt; #   versionIdentifier &lt;chr&gt;</span></code></pre></div>
<p>This highlights who, what, where and when the data sources come from.</p>
</div>
</div>
<div id="constructing-conceptset-defintions" class="section level1">
<h1 class="hasAnchor">
<a href="#constructing-conceptset-defintions" class="anchor"></a>Constructing conceptset defintions</h1>
<p>To generate concept sets we recommend using <a href="https://data.ohdsi.org/PHOEBE/">PHEOBE</a>. This is a simple way of finding standard concepts (SNOMED or RxNorm) that relate to diseases and outcomes of interest for which real world evidence has been observed. For this example we will use the concept for moderate depression as a disease outcome and the ingredient exposure codeine. It is important to note that the CEM stores information in the standard vocabulary only. Similarly drug concepts are mapped at the ingredient level, so you will want to map specific ingredient concepts not drug formulations. For example, instead of using a specific drug dose such as ‘codeine 30 MG’ it would be advisable to use only the ingredient ‘codeine’. Naturally, designing concept sets is highly specific to a phenotype of interest and careful consideration should go into the concepts used.</p>
<p>In this example, we would like to both find any existing evidence that relates these two diseases as well as select potential negative controls that can be used to calibrate p-values and confidence intervals from effect estimates that we may generate in observational studies.</p>
<p>Concept sets can also be imported from ATLAS. See the <a href="https://github.com/OHDSI/ROhdsiWebApi">ROhdsiWebApi package</a> for more information on how to use this in R.</p>
<p>CemConnector requires 3 fields for searching for relationships: <code>conceptId</code>, <code>includeDescendants</code> and <code>isExcluded</code>. Other fields can be present in the <code>data.frame</code>, but will be unused in searches.</p>
</div>
<div id="negative-control-suggestions" class="section level1">
<h1 class="hasAnchor">
<a href="#negative-control-suggestions" class="anchor"></a>Negative control suggestions</h1>
<p>Negative controls are one of the most common ways to use the information within the CEM in observational health research. Cem Connector is capable of suggesting negative controls for use in population level effect estimate studies. Negative controls are intended to be exposures or outcomes selected because they are believed to have no direct causal relationship with the outcome of interest. For example, in-grown toe-nails are not caused by exposure to ACE inhibitors. However, in-grown toenails are extremely common, and many patients will experience this outcome while exposed to the drug. Consequently, any observed effect is a product of residual bias (e.g. from the study design choices) and this can be used to produce calibrated effect estimates.</p>
<p>The design of a PLE study is outside the scope of this viggnette, however, the selection of outcomes/exposures can be achieved at the concept level. Here, the CemConnector takes a concept set as a parameter and finds outcomes our exposures that have no mapped relationships within the CEM. We note that these mappings are not perfect and human curation by experienced clinicians is advised.</p>
<p>To find negative control outcomes for the above ingredient set use the following code, for example the drug <code>Codene</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ingredientConceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1201620</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">outcomeConcepts</span> <span class="op">&lt;-</span> <span class="va">cemConnection</span><span class="op">$</span><span class="fu">getSuggestedControlCondtions</span><span class="op">(</span><span class="va">ingredientConceptSet</span><span class="op">)</span>
<span class="va">outcomeConcepts</span>
<span class="co">#&gt; # A tibble: 50 × 2</span>
<span class="co">#&gt;    conceptId conceptName                        </span>
<span class="co">#&gt;        &lt;int&gt; &lt;chr&gt;                              </span>
<span class="co">#&gt;  1    436070 Vitamin D deficiency               </span>
<span class="co">#&gt;  2     80816 Degeneration of intervertebral disc</span>
<span class="co">#&gt;  3    374375 Impacted cerumen                   </span>
<span class="co">#&gt;  4   4079750 Osteoarthritis of knee             </span>
<span class="co">#&gt;  5    261880 Atelectasis                        </span>
<span class="co">#&gt;  6    201826 Type 2 diabetes mellitus           </span>
<span class="co">#&gt;  7    139099 Ingrowing nail                     </span>
<span class="co">#&gt;  8    381877 Dysfunction of eustachian tube     </span>
<span class="co">#&gt;  9    379805 Myopia                             </span>
<span class="co">#&gt; 10    377910 Deviated nasal septum              </span>
<span class="co">#&gt; # … with 40 more rows</span></code></pre></div>
<p>Alternatively, the use of ingredient exposures may be considered (i.e. drugs thought not to cause or treat a given condition). For example, when searching for depressive disorder and descendants:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conditionConceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">440383</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">outcomeConcepts</span> <span class="op">&lt;-</span> <span class="va">cemConnection</span><span class="op">$</span><span class="fu">getSuggestedControlIngredients</span><span class="op">(</span><span class="va">conditionConceptSet</span><span class="op">)</span>
<span class="va">outcomeConcepts</span>
<span class="co">#&gt; # A tibble: 0 × 2</span>
<span class="co">#&gt; # … with 2 variables: conceptId &lt;int&gt;, conceptName &lt;chr&gt;</span></code></pre></div>
<p>In both cases the row order indicates the rank of the negative control suggestions. This is simply how commonly a co-occurrence has been observed in the OHDSI network. For example, <code>in-grown toe nails</code> and <code>acetominophen</code> are very commonly observed, yet will likely have no medical relationship between drugs and patient outcomes, respectively.</p>
</div>
<div id="exploring-evidence" class="section level1">
<h1 class="hasAnchor">
<a href="#exploring-evidence" class="anchor"></a>Exploring evidence</h1>
<p>The cem contains a It is often desirable to find out what information relates exposures and outcomes. The cem provides a variety of information, including drug product labels, literature searches, clinical trials data and spontaneous adverse event reporting data.</p>
<div id="searching-for-conditions-related-to-exposures" class="section level3">
<h3 class="hasAnchor">
<a href="#searching-for-conditions-related-to-exposures" class="anchor"></a>Searching for conditions related to exposures</h3>
<p>The simplest drug concept set is of one ingredient, for example the drug <code>Codene</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ingredientConceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1201620</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">outcomeConcepts</span> <span class="op">&lt;-</span> <span class="va">cemConnection</span><span class="op">$</span><span class="fu">getIngredientEvidenceSummary</span><span class="op">(</span><span class="va">ingredientConceptSet</span><span class="op">)</span></code></pre></div>
<p>Though not necessary for this ingredient set, we allow the utility to look for descendants. This may be useful for an entire class of medications such as the ATC classification <code>Other opioids</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parentIngredientSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">21604296</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We would like to search for any related disease concepts to this query. Cem connector provides a simple evidence summary for all resulting concepts that are in the database.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcomeConcepts</span> <span class="op">&lt;-</span> <span class="va">cemConnection</span><span class="op">$</span><span class="fu">getIngredientEvidenceSummary</span><span class="op">(</span><span class="va">parentIngredientSet</span><span class="op">)</span>
<span class="va">outcomeConcepts</span>
<span class="co">#&gt; # A tibble: 5,092 × 3</span>
<span class="co">#&gt;    conditionConceptId conceptName               evidenceExists</span>
<span class="co">#&gt;                 &lt;int&gt; &lt;chr&gt;                              &lt;int&gt;</span>
<span class="co">#&gt;  1              22350 Edema of larynx                        1</span>
<span class="co">#&gt;  2              22426 Congenital macrostomia                 0</span>
<span class="co">#&gt;  3              22820 Tuberculosis of esophagus              1</span>
<span class="co">#&gt;  4              22955 Perforation of esophagus               1</span>
<span class="co">#&gt;  5              23034 Neonatal hypoglycemia                  1</span>
<span class="co">#&gt;  6              23137 Chlamydial pharyngitis                 1</span>
<span class="co">#&gt;  7              23220 Chronic tonsillitis                    1</span>
<span class="co">#&gt;  8              23245 Esophageal bleeding                    1</span>
<span class="co">#&gt;  9              23304 Neck webbing                           1</span>
<span class="co">#&gt; 10              23325 Heartburn                              1</span>
<span class="co">#&gt; # … with 5,082 more rows</span></code></pre></div>
<p>The resulting data frame is of ingredient concepts with a 1 or 0 if any evidence exists within the CEM.</p>
<p>For an item here, we may want to look at the specific evidence that is involved. To do this we would look at an exposure outcome pair from the concept set.</p>
<p>To get all the evidence found in the CEM for the ingredient concept set, what source its from and what the counts or statistics are, we can look at the entire search universe.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conditionEvidence</span> <span class="op">&lt;-</span> <span class="va">cemConnection</span><span class="op">$</span><span class="fu">getIngredientEvidence</span><span class="op">(</span><span class="va">parentIngredientSet</span><span class="op">)</span>
<span class="va">conditionEvidence</span>
<span class="co">#&gt; # A tibble: 41 × 16</span>
<span class="co">#&gt;    conceptName1 conceptName2   conceptId1 sourceCode1 sourceCodeType1 conceptId2</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;                &lt;int&gt;</span>
<span class="co">#&gt;  1 Codeine      Jaundice          1201620 1201620     OMOP CONCEPT_ID     137977</span>
<span class="co">#&gt;  2 Codeine      Jaundice          1201620 1201620     OMOP CONCEPT_ID     137977</span>
<span class="co">#&gt;  3 Codeine      Jaundice          1201620 1201620     OMOP CONCEPT_ID     137977</span>
<span class="co">#&gt;  4 Codeine      Jaundice          1201620 1201620     OMOP CONCEPT_ID     137977</span>
<span class="co">#&gt;  5 Codeine      Dysthymia         1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt;  6 Codeine      Dysthymia         1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt;  7 Codeine      Dysthymia         1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt;  8 Codeine      Dysthymia         1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt;  9 Codeine      Feeling nervo…    1201620 1201620     OMOP CONCEPT_ID     436817</span>
<span class="co">#&gt; 10 Codeine      Feeling nervo…    1201620 1201620     OMOP CONCEPT_ID     436817</span>
<span class="co">#&gt; # … with 31 more rows, and 10 more variables: sourceCode2 &lt;chr&gt;,</span>
<span class="co">#&gt; #   sourceCodeType2 &lt;chr&gt;, sourceId &lt;chr&gt;, evidenceType &lt;chr&gt;,</span>
<span class="co">#&gt; #   relationshipId &lt;chr&gt;, statisticValue &lt;dbl&gt;, statisticValueType &lt;chr&gt;,</span>
<span class="co">#&gt; #   uniqueIdentifier &lt;chr&gt;, uniqueIdentifierType &lt;chr&gt;, countHow &lt;chr&gt;</span></code></pre></div>
</div>
<div id="searching-for-drug-ingredients-related-to-conditions" class="section level3">
<h3 class="hasAnchor">
<a href="#searching-for-drug-ingredients-related-to-conditions" class="anchor"></a>Searching for drug ingredients related to conditions</h3>
<p>Searching for conditions can be achieved similar manner. In this example we search for evidence related to Dysthymia.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conditionConceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">433440</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">cemConnection</span><span class="op">$</span><span class="fu">getConditionEvidenceSummary</span><span class="op">(</span><span class="va">ingredientConceptSet</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 0 × 3</span>
<span class="co">#&gt; # … with 3 variables: ingredientConceptId &lt;int&gt;, conceptName &lt;chr&gt;,</span>
<span class="co">#&gt; #   evidenceExists &lt;lgl&gt;</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cemConnection</span><span class="op">$</span><span class="fu">getConditionEvidence</span><span class="op">(</span><span class="va">ingredientConceptSet</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 0 × 16</span>
<span class="co">#&gt; # … with 16 variables: conceptName1 &lt;chr&gt;, conceptName2 &lt;chr&gt;,</span>
<span class="co">#&gt; #   conceptId1 &lt;int&gt;, sourceCode1 &lt;chr&gt;, sourceCodeType1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   conceptId2 &lt;int&gt;, sourceCode2 &lt;chr&gt;, sourceCodeType2 &lt;chr&gt;, sourceId &lt;chr&gt;,</span>
<span class="co">#&gt; #   evidenceType &lt;chr&gt;, relationshipId &lt;chr&gt;, statisticValue &lt;dbl&gt;,</span>
<span class="co">#&gt; #   statisticValueType &lt;chr&gt;, uniqueIdentifier &lt;chr&gt;,</span>
<span class="co">#&gt; #   uniqueIdentifierType &lt;chr&gt;, countHow &lt;chr&gt;</span></code></pre></div>
<p>The mapping between conditions and ingredients is often complicated, for example moderate depressive disorder may not match exactly. Consequently, it may be desirable to explore <code>siblings</code> of the related concept, using the concept ancestry. This can be achieved with the <code>siblingLookupLevels</code> parameter, which is an integer tha can be used to search higher levels in the concept ancestry:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">minorDepressionConceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">440383</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">cemConnection</span><span class="op">$</span><span class="fu">getConditionEvidence</span><span class="op">(</span><span class="va">minorDepressionConceptSet</span>, siblingLookupLevels <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 0 × 16</span>
<span class="co">#&gt; # … with 16 variables: conceptName1 &lt;chr&gt;, conceptName2 &lt;chr&gt;,</span>
<span class="co">#&gt; #   conceptId1 &lt;int&gt;, sourceCode1 &lt;chr&gt;, sourceCodeType1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   conceptId2 &lt;int&gt;, sourceCode2 &lt;chr&gt;, sourceCodeType2 &lt;chr&gt;, sourceId &lt;chr&gt;,</span>
<span class="co">#&gt; #   evidenceType &lt;chr&gt;, relationshipId &lt;chr&gt;, statisticValue &lt;dbl&gt;,</span>
<span class="co">#&gt; #   statisticValueType &lt;chr&gt;, uniqueIdentifier &lt;chr&gt;,</span>
<span class="co">#&gt; #   uniqueIdentifierType &lt;chr&gt;, countHow &lt;chr&gt;</span></code></pre></div>
<p>However, this approach is likely to result in low specificity, when searching for related concepts. It is strongly advised to consider a revised concept set, especially when searching for negative controls.</p>
</div>
<div id="searching-for-evidence-pairs" class="section level3">
<h3 class="hasAnchor">
<a href="#searching-for-evidence-pairs" class="anchor"></a>Searching for evidence pairs</h3>
<p>The relationships between specific ingredient and condition based concept sets are often highly informative. A goal of Cem connector is allowed exploration of this evidence. For example, we may be interested in what evidence (if any) relates <code>codene</code> with <code>Dysthymia</code>, this can be achieved with the use of the relationships method:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conditionConceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">433440</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">ingredientConceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1201620</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, isExcluded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">cemConnection</span><span class="op">$</span><span class="fu">getRelationships</span><span class="op">(</span>conditionConceptSet <span class="op">=</span> <span class="va">conditionConceptSet</span>, ingredientConceptSet <span class="op">=</span> <span class="va">ingredientConceptSet</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 16</span>
<span class="co">#&gt;   conceptName1 conceptName2 conceptId1 sourceCode1 sourceCodeType1 conceptId2</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;             &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;                &lt;int&gt;</span>
<span class="co">#&gt; 1 Codeine      Dysthymia       1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt; 2 Codeine      Dysthymia       1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt; 3 Codeine      Dysthymia       1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt; 4 Codeine      Dysthymia       1201620 1201620     OMOP CONCEPT_ID     433440</span>
<span class="co">#&gt; 5 Codeine      Dysthymia       1201620 D003061     MeSH                433440</span>
<span class="co">#&gt; 6 Codeine      Dysthymia       1201620 D003061     MeSH                433440</span>
<span class="co">#&gt; # … with 10 more variables: sourceCode2 &lt;chr&gt;, sourceCodeType2 &lt;chr&gt;,</span>
<span class="co">#&gt; #   sourceId &lt;chr&gt;, evidenceType &lt;chr&gt;, relationshipId &lt;chr&gt;,</span>
<span class="co">#&gt; #   statisticValue &lt;dbl&gt;, statisticValueType &lt;chr&gt;, uniqueIdentifier &lt;chr&gt;,</span>
<span class="co">#&gt; #   uniqueIdentifierType &lt;chr&gt;, countHow &lt;chr&gt;</span></code></pre></div>
<p>Here we see a number of relationship definitions that relate the two concept sets, including PubMed literature (via mesh terms) as well as spontaneous reports for adverse eventsand product labels. Refer to <code>cemConnection$getCemSourceInfo()</code> as this will strongly relate to the data sources as well as the date of generation.</p>
</div>
</div>
<div id="study-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#study-packages" class="anchor"></a>Study packages</h1>
<p>We can use the CemConnector package to pull down a selection of negative control suggestions to use within a population level effect estimate study. For an example of a PLE study, see the skeleton package:</p>
<p><a href="https://github.com/OHDSI/SkeletonComparativeEffectStudy" class="uri">https://github.com/OHDSI/SkeletonComparativeEffectStudy</a></p>
<p>These are outcome pairs for target exposures that have no mapping to literature searches, drug product labels, clinical trials or statistically significant spontaneous adverse event reports.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"ohdsi/CemConnector"</span><span class="op">)</span>
<span class="co"># URL tbc</span>
<span class="va">cemUrl</span> <span class="op">&lt;-</span> <span class="st">"https://cem.ohdsi.org"</span>
<span class="va">cemConnection</span> <span class="op">&lt;-</span> <span class="fu">CemConnector</span><span class="fu">::</span><span class="fu"><a href="../reference/createCemConnection.html">createCemConnection</a></span><span class="op">(</span>apiUrl <span class="op">=</span> <span class="va">cemUrl</span><span class="op">)</span>
<span class="co"># Celecoxib/Diclofenac cohort concept set</span>
<span class="va">conceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>conceptId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1118084</span>, <span class="fl">1124300</span><span class="op">)</span>, includeDescendants <span class="op">=</span> <span class="cn">TRUE</span>, isExcluded <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Here we selected a concept set that defines the ingredients in our target and comparator exposures. The concept set search will automatically exclude any outcomes for which evidence exists. Therefore, it is vital to select this concept set with care.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">suggestedControls</span> <span class="op">&lt;-</span> <span class="va">cemConnection</span><span class="op">$</span><span class="fu">getSuggestedControlCondtions</span><span class="op">(</span><span class="va">conceptSet</span>, nControls <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>As evidence mapping is imperfect, it is highly advisable to view the suggested negative controls and refine them before adding them to the study package. The <code>nControls</code> parameter allows the selection of many controls that can be filtered, by default this is set to 50, the order returned is ranked according to how often the condition/drug pairing appears in OHDSI network studies. The selected controls can be appended to the study package, making sure to specify the target and comparator correctly:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">CemConnector</span><span class="fu">::</span><span class="fu"><a href="../reference/addControlsToStudyPackage.html">addControlsToStudyPackage</a></span><span class="op">(</span>controlConcepts <span class="op">=</span> <span class="va">filteredControls</span>,
                                        targetId <span class="op">=</span> <span class="va">targetId</span>,
                                        comparatorId <span class="op">=</span> <span class="va">comparatorId</span>,
                                        fileName <span class="op">=</span> <span class="st">"inst/settings/NegativeControls.csv"</span>,
                                        type <span class="op">=</span> <span class="st">"outcome"</span><span class="op">)</span></code></pre></div>
<p>We also need logic to convert the concept IDs into cohorts. This logic is defined in the file <code>inst/sql/NegativeControlOutcomes.sql</code>. The default logic simply creates a cohort for every occurrence of the concept ID or any of its descendants in the condition era table. If other logic is required the SQL file can be modified. Be sure to use template SQL as expected by the <code>SqlRender</code> package.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jamie Gilbert.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
